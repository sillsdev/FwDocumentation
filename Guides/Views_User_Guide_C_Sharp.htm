<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="Views_User_Guide_C_Sharp_files/filelist.xml">
<link rel=Edit-Time-Data href="Views_User_Guide_C_Sharp_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Views component architecture</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="City"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="State"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="date"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Randy Regnier</o:Author>
  <o:LastAuthor>John Thomson</o:LastAuthor>
  <o:Revision>33</o:Revision>
  <o:TotalTime>7211</o:TotalTime>
  <o:Created>2004-05-14T22:25:00Z</o:Created>
  <o:LastSaved>2004-05-21T18:36:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>10110</o:Words>
  <o:Characters>57632</o:Characters>
  <o:Company>SIL</o:Company>
  <o:Lines>480</o:Lines>
  <o:Paragraphs>135</o:Paragraphs>
  <o:CharactersWithSpaces>67607</o:CharactersWithSpaces>
  <o:Version>10.3501</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Compatibility>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	font-weight:bold;}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	font-weight:bold;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:869997756;
	mso-list-template-ids:834973844;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1
	{mso-list-id:892621880;
	mso-list-template-ids:1882754046;}
@list l1:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:1200514069;
	mso-list-template-ids:-2113643072;}
@list l2:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:2029872439;
	mso-list-template-ids:1822859240;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l4
	{mso-list-id:2108891804;
	mso-list-template-ids:-113889900;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
<meta http-equiv=Content-Language content=en-us>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<h1>Views user guide</h1>

<p>John Thomson, <st1:date Year="2001" Day="5" Month="3">5 March 2001</st1:date>.
File: Views_User_Guide_C_Sharp.htm.</p>

<p>Eberhard Beilharz, <st1:date Year="2002" Day="19" Month="6">19 June 2002</st1:date>.
Modified so that it corresponds to changed MakeRoot method.</p>

<p>John Thomson, 14 May 2004. Started adapting C#/.NET version from C++/AppCore
version.</p>

<h1>1 Introduction</h1>

<p>The FieldWorks Views component serves several functions:</p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>It provides a high-level
	 interface to the FieldWorks text rendering and editing code, insulating
	 programmers from many of the complexities of laying out potentially
	 mixed-direction text that may be rendered by a variety of different
	 engines. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>It provides sophisticated
	 control over the layout of information, approaching what can be done using
	 XML and XSL to produce HTML with styles. In addition, it can create interlinear
	 layouts. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>It maintains information
	 about the source of each bit of text in the display. This means that, with
	 minimal effort, a layout can function as an editor for many purposes.
	 Also, when the data changes, it is readily possible to automatically
	 update all places where it is displayed. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>It provides replacements for
	 a number of Windows common controls which take text input as FieldWorks
	 TsString objects and can render styled, multilingual strings using
	 FieldWorks rendering. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>It supports random scrolling
	 through very large (book length) windows without pre-loading all the
	 necessary data. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l2 level1 lfo1;tab-stops:list .5in'>* It provides a number of
	 standard dialogs which can be used for text formatting, helping to give
	 FieldWorks applications a standard look and feel. These dialogs include an
	 MS-Word-like character and paragraph named style mechanism. </li>
</ol>

<p>(* indicates a planned capability not yet implemented. The standard dialogs
are actually implemented, but not all are yet packaged into a DLL usable
through COM).</p>

<p>The component breaks down into two main blocks of code (which we may even
decide to make separate DLLs). The first part has to do with data layout,
editing, source tracking, and partial loading of large documents. This code is
highly interconnected and very complex. It has been carefully kept as portable
as possible, avoiding direct use of the Windows API and data structures as much
as possible.</p>

<p>The other part is a collection of largely independent chunks of code, each
of which implements a particular dialog or ActiveX control.</p>

<p>The ideas behind the Views component were largely inspired by <st1:State><st1:place>T<sub>E</sub>X</st1:place></st1:State>
(see <i>The TeXbook</i> by Donald E. Knuth, ISBN 0-201-13448-9, published
jointly by the American Mathematical Society and Addison-Wesley Publishing
Company) and HTML (<a href="http://www.w3.org/MarkUp/">http://www.w3.org/MarkUp/</a>).</p>

<h1>2 Basic concepts</h1>

<p>A &quot;view&quot; is a way of looking at data and, possibly, editing it.
Usually the problem is to display and edit data which has a moderately or
extremely complex underlying structure, while insulating the end user from as
much as possible of the complexity.</p>

<p>For example, in our database we may have a set of tables which describe an
Event. An Event has a title, a type (observation, interview, etc.), a
Description (the main body of the event, which in turn is made up of paragraph
records), Sources (a list of links to records in another table which contains
information about people), Locations and other similar lists, a time, a set of
tags (links to records in one of several outlines used to categorize data),
personal notes, and yet other things. We would like to present this information
as a something that is recognizable as a report on the event. For example, one
Data Notebook presentation of the data looks like this:</p>

<p align=center style='text-align:center'><img border=0 width=655 height=722
id="_x0000_i1025" src="Views_User_Guide_C_Sharp_files/VUG_fig_1.jpg"></p>

<p align=center style='text-align:center'>Figure 1. Screen shot from Data
Notebook</p>

<p>Getting something like this onto the screen is not trivial. Obviously it has
to start with getting data from the database (or file, or whatever), including
following the relevant links to things like rows in the table of People and
extracting the Researcher's name. (And the name may be recorded in English,
Korean, and French, so you have to make sure to get the right version.)</p>

<p>Then, the data has to be organized into paragraphs, the appropriate labels
have to be inserted, and it has to be formatted, with the appropriate pieces
bold, the appropriate space between paragraphs, and so forth. The tag
indicating that this record is an Event has to be placed in the right margin.</p>

<p>Of course you want the user to be able to scroll through it all, and the
layout has to be recomputed if the width of the window changes, and again to
fit the page if the user asks to print it.</p>

<p>Then, suppose the user clicks somewhere and starts typing. It may be obvious
to the user that he is trying to edit the second paragraph of the Description
of the event, but it is non-trivial for you to figure that out from the fact
that he is editing the third paragraph in the window. And if you get down to
the fifth paragraph, you need to be ready to allow the user to edit the date of
the event, but pretty much anywhere else in that paragraph shouldn't just be
edited. (A label like &quot;sources&quot; can't be changed at all, and this is
probably not the place to be changing the spelling of Dr Livingston's name,
which may be used by many records.)</p>

<p>Also, the user may be looking at this data in other ways. The Data Notebook
will allow another window to be open at the same time, displaying the same data
in &quot;Data Entry&quot; mode, like this:</p>

<p align=center style='text-align:center'><img border=0 width=658 height=601
id="_x0000_i1026" src="Views_User_Guide_C_Sharp_files/VUG_fig_2.jpg"></p>

<p align=center style='text-align:center'>Figure 2. Screen shot from Data
Notebook, Data Entry mode.</p>

<p>In this mode the user can change the researcher to something else. When this
happens, the display in the first window ought to be updated too. Moreover, the
new name probably has a different length. Therefore, the part of the fifth
paragraph which contains the date and can be edited will have to move.</p>

<p>The View subsystem and the code which supports using it with a database is
designed to deal with these kinds of problems. It allows you to specify in a
declarative way that you want certain data in your view, and (also largely
declaratively) that you want certain formatting, certain properties to appear
in certain paragraphs or tables, or that you want to insert at a certain point
another view which, itself, may be a complex organization of data.</p>

<p>Once things are so specified, the Views subsystem does the actual layout and
rendering, keeps track of what database property is displayed where, updates
the display when the data changes, and (if you so specify) allows the user to
edit, figures out what needs to change in the database to correspond to that
editing, and updates the database.</p>

<p>A view can also operate on top of an ordinary file (without using a
database). In this case, you are responsible to load the file format into a
“cache” in memory, and to write a new version of the document from the cache
information if the user changes it.</p>

<h2>2.1 Using views</h2>

<p>There are in general three main aspects to using the core view code.</p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l1 level1 lfo2;tab-stops:list .5in'>Connecting it to a window so
	 that it can display itself and interact with the user </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l1 level1 lfo2;tab-stops:list .5in'>Connecting it to a source of
	 data that it will display and possibly edit. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l1 level1 lfo2;tab-stops:list .5in'>Configuring it to lay that
	 data out the way you want. </li>
</ol>

<p>The more specialized .NET controls (see fw\src\common\controls\widgets) will
do a lot of this work for you. The first point is replaced by the normal
requirements for hosting a control, and in many cases the control takes care of
the data source and layout concerns and exposes a simpler interface by which
you read and write strings. The most general of the planned ActiveX controls
allows you to provide the data source and layout configuration while still
taking care of the window hookup.</p>

<p>The main way to make custom views is to subclass RootSite or SimpleRootSite
(see fw\src\common\Rootsites) and implement a MakeRoot method to create the
root box and hook up the data and configuration interfaces. Since this is the
approach that is fully supported at present, it will be the one we discuss at
length in this document.</p>

<p>It is also possible to display a view without using any of these window
classes. (One example is AfDeSplitChild, which displays several distinct views
within a single window. There are no C# examples of doing this at present.)
When you do this you have quite a bit of work to do to make sure that all
necessary events are passed to the view and all events it generates are
properly handled. Few people will want to do this, but in case you do, the
process is outlined in the Views Architecture document, and AfDeSplitChild (or
the classes in AfVwWnd itself) can function as examples.</p>

<h1>3 &quot;Hello world&quot;</h1>

<p>Let's create a very simple, but complete, View-based display. We'll make
something like the HelloView.Net which displays &quot;Hello world! This is a
view&quot; using a view. You can see the completed project at
fw\samples\samples.net\HelloView.</p>

<p>This assumes that you have set up your computer for working with FieldWorks
(see fw\Doc\FieldWorks Setup\FieldWorks Setup.mht) and successfully built the
existing components (fw\bin\remakefw.bat). In particular this creates various
DLLs in fw\output\debug that you will need to reference.</p>

<h2>3.1 Making a project</h2>

<p>First you will want to make a new project. Follow the usual process to make
a new C# Windows Application. You will probably need at least the following
references:</p>

<ul style='margin-top:0in' type=disc>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>COMInterfaces
	 – support for interfacing with COM components generally </li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>ViewsInterop
	 – defines the Views interfaces </li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>RootSite
	 – support for hosting views </li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>xCoreInterfaces
	 – RootSite has a dependency on this, it helps implement common commands if
	 you use xCore </li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>FwKernelLibInterop
	 – Defines the ITsString interface used throughout views, various lists of
	 display properties. </li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo3;tab-stops:list .5in'>FwLanguageLibInterop
	 – Defines ILgWritingSystemFactory, a required parameter for initializing
	 many objects. </li>
</ul>

<p>Usually we create a link to the DLLs in fw\output\debug. The release build
of a real program will, of course, want to link to corresponding DLLs in
fw\output\release. In a real project you will set up a Nant target and use Nant
for the final build; our Nant build process fixes these links when doing a
release build. (Todo: cross-ref doc on how to set up Nant projects.)</p>

<p>(Note that several other DLLs are needed in order to actually run a Views
program…at least Views.dll, Language.dll, Kernel.dll.)</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.2
The view window class</h2>

<p>Your main form is going to contain a ‘control’ that actually contains the
view. You will create a new class that inherits from SimpleRootSite. (If your
view will directly display database data, you would instead inherit from
RootSite.)</p>

<p><span style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
SimSun;color:blue'>public</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'> <span style='color:blue'>class</span> HelloViewView
: SIL.FieldWorks.Common.RootSites.SimpleRootSite<o:p></o:p></span></p>

<p><span style='mso-fareast-font-family:SimSun'>Todo: research what is the best
way to create this. I usually just copy an existing class. How well does it
work with the forms designer?</span></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.3
Introduction to &quot;MakeRoot&quot;</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Now,
when you have a RootSite or SimpleRootSite, you are required to write a
&quot;MakeRoot&quot; method, which creates and initializes the object that
represents the view. On the other hand, you don't have to implement OnPaint; if
the forms designer created that for you delete it. Add a MakeRoot method:</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue'>public</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'> <span style='color:blue'>override</span> <span
style='color:blue'>void</span> MakeRoot()</span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
first two lines of this method are pretty much common to all MakeRoot methods.
They create a &quot;root box&quot; and hook it to the window (the
SimpleRootSite, which you have subclassed) that will function as a
&quot;site&quot; for it. (The &quot;site&quot; interface is fully implemented
by SimpleRootSite and therefore inherited; you don't have to do anything about
it.)</p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>            </span><span style='color:blue'>public</span>
<span style='color:blue'>override</span> <span style='color:blue'>void</span>
MakeRoot()<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>            </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>m_rootb = (IVwRootBox)<span
style='color:blue'>new</span> FwViews.VwRootBoxClass();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>m_rootb.SetSite(<span
style='color:blue'>this</span>);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-spacerun:yes'> </span>Let's look at the end of the method next. Most
of what comes between is preparing for the SetRootObject() call, which tells
the view what to display and how. Once we've done it, all that remains is to
set a couple of instance variables to tell the root site that initialization of
the root box is complete, and that the view has not yet been ‘laid out’ to a
particular width. (Todo: both these tasks should be handled by the framework
after calling MakeRoot and confirming that one got made.)</p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>m_fRootboxMade = <span
style='color:blue'>true</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>m_dxdLayoutWidth = -50000; <span
style='color:green'>// Don't try to draw until we get OnSize and do layout.<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>            </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
view can potentially display multiple top-level objects, in which it gets
initialized using a slightly different method (SetRootObjects). But by far the
most common case (in fact the only thing we've tested, I think) is to display
just one top level object. In such cases, the main initialization call is
SetRootObject. We will now walk through the process of assembling its
arguments.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
first argument specifies the &quot;root&quot; object we want to display,
represented as an integer. The view does not interpret this integer…it just
passes it to various other methods Often is it is ID of a row in the CmObject
table in the database. Commonly it is abbreviated with HVO, which stands for
‘Handle to a Viewable Object.’ We're going to simulate our data object, so we
can use anything we like for our handle. Thus, we can provide the first
argument just like this:</p>

<pre><span style='mso-tab-count:1'>        </span>int<span style='mso-spacerun:yes'>  </span>hvoRoot = 1;</pre>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.4
A data source</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Before
we get back to the other arguments, let's think about having some actual data
to display. The view needs a source of data. For our data source we will use a
&quot;VwCacheDa&quot;, a simple in-memory data source that just makes available
to the view whatever data we give it. Usually you will want this data source to
be available to all you methods, so you will put it in a member variable. We
can make one like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>ISilDataAccess
m_sda;<span style='mso-spacerun:yes'>  </span>// In member variable section.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>…<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda
= (ISilDataAccess) <span style='color:blue'>new</span>
FwViews.VwCacheDaClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ILgWritingSystemFactory
wsf = (ILgWritingSystemFactory) <span style='color:blue'>new</span>
FwLanguage.LgWritingSystemFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda.set_WritingSystemFactory(wsf);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.set_DataAccess(m_sda);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
data access object requires a writing system factory, which is used to interpret
strings stored in it. If you are working with a database, you will get a
corresponding WSF from your FdoCache. For non-database projects, make a WSF as
above. (In this case, definitions of any needed writing systems are found in
the registry. Suitable defaults will be provided for ordinary Roman writing
systems.) Note that the root box needs to be told about the data access object.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Now
we want to put some data in it. Specifically, we are going to tell it that our
&quot;object&quot; (hvoRoot) has a string &quot;property&quot; identified by a
constant, ktagProp, whose value is &quot;Hello World! This is a view&quot;.
Strings in the View world are represented as ITsString objects. They are
created by a String factory object, and they need a &quot;writing system&quot;
that specifies their language. The complete code to get a string factory, get
the writing system for the ‘default user’ language, and make a string looks
like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                      </span>ITsStrFactory
tsf = (ITsStrFactory)<span style='color:blue'>new</span>
FwKernelLib.TsStrFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ITsString
tss = tsf.MakeString(&quot;Hello World! This is a view&quot;,
wsf.get_UserWs());<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Now
we tell the data object that this string is to be the value of the ktagProp
property of our root object. (The ktagProp constant is given an arbitrary value
by means of a cocnst int declaration). In real views based on a database, you
will usually use constants that identify a particular property of a particular
object class, taken from an enumeration defined by each FDO class.)
Initializing the data in a VwCacheDa is done through an additional interface on
the data access object, IVwCacheDa.</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>IVwCacheDa
cda = (IVwCacheDa) m_sda;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>cda.CacheStringProp(hvoRoot,
ktagProp, tss);<o:p></o:p></span></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.5
A view constructor</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>OK,
we have some data. Next we have to tell the view what to do with it. What to do
with it is often quite complex, though in this case it will be simple; but to
allow for the complexity, the layout is specified by writing a piece of code
called a &quot;view constructor&quot;. You need to make a new class. Ours looks
like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='color:blue'>public</span> <span style='color:blue'>class</span> HvVc:
VwBaseVc<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>We
inherit from VwBaseVc so as to get trivial implementations of a number of
methods that are in the interface but which won't be used in this case. Almost
all view constructor implementations do this. The one actual method we write is
Display(). It looks like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>public</span> <span style='color:blue'>override</span> <span
style='color:blue'>void</span> Display(IVwEnv vwenv, <span style='color:blue'>int</span>
hvo, <span style='color:blue'>int</span> frag)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>switch</span> (frag)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>default</span>:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>case</span> HelloViewView.kfrText:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span><span
style='color:red'>vwenv.AddStringProp(HelloViewView.ktagProp, this);<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
only really important line in this is the red one, the AddStringProp call. For
a case this simple, that could have been the whole method body. This is because
our view constructor only knows how to display one kind of object (one that has
a string property identified by ktagProp) in one way (by showing the string). A
typical view constructor, however, may know how to display several kinds of
objects, perhaps in several ways each. To distinguish the different things it
can do, a Display method takes an argument called a &quot;fragment
identifier.&quot; Think of it as telling the Display method which
&quot;fragment&quot; of a more complex view is to be dealt with at present.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Thus,
the method above illustrates the usual structure of a Display method: a switch
on the frag argument. In this case, we have made a constant kfrText to identify
the &quot;text&quot; fragment, even though it is the only one we have. Again,
this is given an arbitrary value by a const int declaration.</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.6
Finishing off MakeRoot</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Now
we are ready to go back to the SetRootObject method. The second argument is a
view constructor, which will be asked to Display the root object. The third
argument tells the root box which fragment identifier to pass to the Display
method. So, we need an HvVc, and we need to pass the kfrText fragment. The
balance of the method looks like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_vVc
= <span style='color:blue'>new</span> HvVc();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.SetRootObject(hvoRoot,
m_vVc, kfrText, <span style='color:blue'>null</span>);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-spacerun:yes'> </span>(In this simple case, we could just embed ‘new
HvVc()’ in the SetRootObject call. Often there will be reasons to have a member
variable for your view constructor, however.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>To
put it all together, here is the entire MakeRoot method:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><a name="Simple_MakeRoot"></a><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>               </span><span style='color:blue'>public</span>
<span style='color:blue'>override</span> <span style='color:blue'>void</span>
MakeRoot()<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb
= (IVwRootBox)<span style='color:blue'>new</span> FwViews.VwRootBoxClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.SetSite(<span
style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>int</span> hvoRoot = 1;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda
= (ISilDataAccess) <span style='color:blue'>new</span>
FwViews.VwCacheDaClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ILgWritingSystemFactory
wsf = (ILgWritingSystemFactory) <span style='color:blue'>new</span>
FwLanguage.LgWritingSystemFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda.set_WritingSystemFactory(wsf);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.set_DataAccess(m_sda);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                      </span>ITsStrFactory
tsf = (ITsStrFactory)<span style='color:blue'>new</span>
FwKernelLib.TsStrFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ITsString
tss = tsf.MakeString(&quot;Hello World! This is a view&quot;,
wsf.get_UserWs());<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>IVwCacheDa
cda = (IVwCacheDa) m_sda;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>cda.CacheStringProp(hvoRoot,
ktagProp, tss);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_vVc
= <span style='color:blue'>new</span> HvVc();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='mso-tab-count:2'>               </span>m_rootb.SetRootObject(hvoRoot,
m_vVc, kfrText, <span style='color:blue'>null</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_fRootboxMade
= <span style='color:blue'>true</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_dxdLayoutWidth
= -50000; <span style='color:green'>// Don't try to draw until we get OnSize
and do layout.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.7
Using it in a form</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
final step is to place an instance of your view class on your main form. The
initializeComponent method looks like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>private</span> <span style='color:blue'>void</span>
InitializeComponent()<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView = <span style='color:blue'>new</span>
SIL.FieldWorks.Samples.HelloView.HelloViewView();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.SuspendLayout();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// <o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// myView<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// <o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView.BackColor =
System.Drawing.SystemColors.Window;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView.ForeColor =
System.Drawing.SystemColors.WindowText;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView.Location = <span style='color:blue'>new</span>
System.Drawing.Point(16, 32);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView.Name = &quot;myView&quot;;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='mso-tab-count:2'>               </span><span style='color:blue'>this</span>.myView.Size
= <span style='color:blue'>new</span> System.Drawing.Size(232, 192);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.myView.TabIndex = 0;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// <o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// HelloView<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// <o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.AutoScaleBaseSize = <span style='color:blue'>new</span>
System.Drawing.Size(5, 13);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.ClientSize = <span style='color:blue'>new</span>
System.Drawing.Size(292, 273);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.Controls.AddRange(<span style='color:blue'>new</span>
System.Windows.Forms.Control[] {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:13'>                                                                                             </span><span
style='mso-tab-count:5'>                                      </span><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>this</span>.myView});<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.Name = &quot;HelloView&quot;;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.Text = &quot;HelloView.NET&quot;;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>this</span>.ResumeLayout(<span style='color:blue'>false</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>(Review:
can this be done with the forms designer? Do we need to do something to make
the designer able to use it?)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>That's
it! Build and run this program and you get a working application which displays
the string (and even allows you to edit it, though the changes won't be saved
anywhere).</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>3.8
How is a real view different?</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Configuring
a more serious view is much like the code above. In nearly every case, you will
create a new View Constructor class. You will make a new Control class
inheriting from SimpleRootSite, RootSite, or a similar class. You will write a
MakeRoot method with the same basic components as above:</p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Creating a root box. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Connecting it to its site. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Creating or locating a data
	 source. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Initializing the data source
	 with the appropriate data. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Hooking the data source to
	 the view. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Creating an instance of the
	 appropriate view constructor. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Identifying the root object
	 you want to display by an appropriate handle. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Identifying the
	 &quot;fragment code&quot; that should be used initially to display that
	 object. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Hooking things up using
	 SetRootObject. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
	 mso-list:l4 level1 lfo4;tab-stops:list .5in'>Setting m_fRootBoxMade and
	 m_dxdLayoutWidth. </li>
</ul>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Now
that we've worked through an example, we can go on to examine the data source
and the view constructor in more detail.</p>

<h1 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>4
Configuring a view: data source</h1>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
view displays data which is conceptually organized as a network of objects that
have properties. The view doesn't care what the objects are; in most of our
current work they are groups of rows in several tables of a relational
database, linked by a shared ID. But they can also be lines in an XML or SF
file. As far as the view is concerned, an object is simply represented by a
handle (an int, often called a ‘Handle to a Viewable Object,’ or HVO). (For
database work the ID of the table rows serves as the value of the handle. When
working with text files we usually assign arbitrary IDs based on the sequence
of items in the file.) The integer can mean anything you like; you just have to
be consistent within any one data source and in initializing the root box.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
view generally needs to be able to find out what properties a particular object
has. An object can have both simple properties (strings, numbers, dates, etc.)
and properties that link it to one or a sequence of other objects. For example,
an HVO that represents a lexicon entry might have a headword string property, a
property that links it to the HVO of the dictionary it is part of, and a
property that links it to a sequence of HVOs for objects representing its
senses.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
interface ISilDataAccess is used to provide the view with this information. It
has a collection of methods to support different property data types, but
basically it just allows you to read or write the value of a particular
property. Which property is identified by an HVO and a tag or flid. (Tag is a
completely generic term used in the view code, which doesn't care how a tag
identifies a property. A lot of our client code uses database field identifiers
or flids to identify properties.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
most commonly used implementation of ISilDataAccess is obtained from an
FdoCache using the MainCacheAccessor method. This is a very sophisticated data
access object with considerable knowledge about the database (for example, it
can automatically load properties from the database on demand.) Also available
are VwCacheDa, a very simple implementation that allows you to simply pre-load
the data you want to view and lets you (or the view) read back the current
value of any property.</p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><img
border=0 width=513 height=376 id="_x0000_i1027"
src="Views_User_Guide_C_Sharp_files/View_Data_Sources.gif"></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>4.1
VwCacheDa</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Simple
views are most often set up using VwCacheDa. (The name comes from its function
of caching data from some other source; it has no built-in way of persisting
the data.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>VwCacheDa
is built into the Views DLL and can be created using <span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'>(ISilDataAccess)
<span style='color:blue'>new</span> FwViews.VwCacheDaClass()</span>.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>VwCacheDa
has a rudimentary way of telling whether the user changed something using the
view. To support this, there is an additional interface, IVwCacheDa, a set of
methods whose names begin with &quot;Cache&quot;. These methods are used to
load data into the cache. At this point, the data is considered
&quot;clean,&quot; that is, not modified by the user. There is another set of
methods which the View code will use if the user modifies the data; these
methods mostly begin with &quot;Set&quot;. You can use a method called
IsDirty() to tell whether any of the modification methods has been used.
(Unfortunately, this method is not yet in the interface…we should add it.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>At
present there is no interface method to tell what properties of what objects
have changed. This could easily be added but we have not yet needed it; current
code using VwCacheDa just makes a complete new file, or something similar, when
anything changes. The data it would depend on is recorded. Another oversight is
the lack of a method to clear the dirty flag when changes are saved. This also
needs to be added.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
simple example of using VwCacheDa was provided above. A much more complex one
may be found in the IText Sandbox class. (Todo: I also hope to add a more
complex one for discussion below.)</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>4.2
CustViewDa</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>(Todo:
rewrite or replace this section with something relevant to C#)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
name of this class is obsolete and will probably change; it refers to the
original application of the class, providing the data that a &quot;customizable
view&quot; requires.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>CustViewDa
reads and writes data from a database that can be accessed using OLEDB. You
initialize it with an OleDbEncap object which encapsulates a connection to the
database.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>CustViewDa
allows you to specify that data for a whole network of objects should be
loaded. You start by giving it the HVOs and class identifiers of one or more
top-level objects (it can help you load this information, too). By default, it
then proceeds to load information about all the objects that are &quot;parts&quot;
of the top-level ones (technically all the owning properties of those objects).</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
result of this process is a more complete list of HVOs for a whole network of
objects, and properties indicating how they are connected and what the class of
each object is.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
remaining step is to tell the CustViewDa what other properties of the objects
your view requires. You do this on a class-by-class basis, creating a list of
properties to load for each class. You can distinguish between the properties
that should be loaded for an object in the original list, versus those that
should be loaded for an object of the same class that occurs somewhere further
down the hierarchy.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Todo
JohnT: get someone to create a working example, say of an editor for structured
texts in the database.</p>

<h1 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5
Configuring a view: layout</h1>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.1
Overview</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Layout
is the part of hooking up a view that you usually have to write your own code
for. Some of the simpler controls don't require this, as they just edit a
single string, or a &quot;<a href="../fieldworks_glossary.htm#StText">structured
text</a>&quot; for which there is a standard layout. Anything more complex
means writing code to specify the layout.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>This
begins by your specifying a root object, by passing an <a
href="../fieldworks_glossary.htm#HVO">HVO</a> for a root object to the
SetRootObject() method of the root box.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
view then makes calls back to your code to ask you how exactly you want the
root object displayed. This may lead to your telling the view to display other
objects that are parts of the root object or otherwise related to it. The view
then turns around and asks you how to display each of those, and so forth. The
back and forth process is designed to give you control over the layout while
allowing the view to keep track of the relationship between what is on the
screen and the underlying data. Also, it is designed to be modular: you don't
have to construct the whole layout in one go, and in fact, the view code may
not ask you to lay out certain parts until the user scrolls them into view. It
is also modular in that a layout for a certain kind of object can be re-used in
various places where that kind of object shows up.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>For
the views code to call your code, you have to implement some interface, since
interfaces are the only way COM objects communicate. The particular interface
you need to implement is defined in the Views subsystem; it is called
IVwViewConstructor. Typically, the code you actually write is a switch, with at
least one case for each type of object you need to display. Depending on the
complexity of the view, you may need only one method, or several. To help,
especially with the simpler cases, there is a base class, VwBaseVc, which
trivially implements all the methods to fail (throwing E_NOTIMPL). Thus, you
only have to write the methods you need. The one required method is Display().
It is passed an HVO, initially identifying the root object, and two other
arguments, which I will explain in a moment. Other methods only have to be
implemented if you use particular capabilities of the system.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
first argument to Display is an IVwEnv. This name is short for View
Environment, a slightly awkward term borrowed from functional programming and
meaning an object that represents the state of an incomplete computation (in
this case, the incomplete construction of the view layout). This interface is
provided in order to allow you, in turn, to make call-backs to the view
subsystem to tell it what to do about displaying the object. It has methods for
telling the view to make a paragraph or table, to change various style
properties, to insert some literal text, and so forth. You can also tell it to
insert some property of the current object.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>&quot;Property&quot;
is used here in a technical sense. The view code considers an object to be a
bundle of properties. Some of them are simple, holding a number or a string. In
that case, you just tell the IVwEnv to display a string or number property,
passing a tag to indicate which property. Some properties are more complex,
holding a reference to another object or a sequence of them.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>When
you tell the IVwEnv to display a property that contains objects, it turns
around and calls your Display method again (typically...there are a couple of
other options, depending on just how you told it to display the property). For
a sequence property, it will call Display repeatedly, passing the HVO of each
of the objects in the property.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=Fragment></a>Now, it is possible that your view constructor recognizes
each of the HVO's for each object in your data and knows what to do with each.
It is more usual, however, that you are going by the structure of the data. You
know what kind of root object your view is going to display, so you know what
properties to display for that kind of object. For each of its properties, you
know the sorts of objects that could be stored there, so when you tell the
IVwEnv to display property X, you know what kind of objects they will be, at
least roughly.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>This
brings us to the third argument to Display, which is a &quot;fragment
identifier.&quot; Usually, this is the control argument for your switch
statement. When you initialize the root box, you pass a fragment identifier (to
SetRootObject), which is passed on to you in the first Display call. You can
use it to select the proper case for your root object. When you ask the view to
display an object-containing property, you specify a fragment, which is then
passed back to you in the resulting Display calls, and typically used to select
an appropriate case for the type of objects in that property. Of course, by
passing different fragment identifiers, you can display the same object in
different ways. By reusing a fragment identifier, you can also display the same
kind of object the same way from different places. (For example, several
properties might refer to a possibility list item and need to display its
name.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
view remembers what part of the screen is displaying the value of a particular
property. If that property changes, the view reads the new value, and repeats
whatever it did with the value originally to obtain a display of the updated
value. (For example, it may call your Display method again, passing the current
HVOs stored in the property, and the fragment you originally told it to use for
that display of that property.) In certain cases, the view is also able to
recognize user actions as editing a particular property, and will make calls to
the ISilDataAccess to update the property value.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Why
not just let you look up the values of properties, loop through the HVOs, and
do whatever is appropriate with each? The reason is that the view code wants to
keep certain kinds of control over the process. It wants to know where a
particular property starts and ends. It wants to be able to replace the display
of a property, or a few objects within a property, without rebuilding the whole
view from the top down. It wants to be able to postpone some parts of the
display generation until the results will actually be visible at the current
scroll position. This architecture gives the view enough control to do these
kinds of things.&nbsp;</p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><img
border=0 width=609 height=340 id="_x0000_i1028"
src="Views_User_Guide_C_Sharp_files/View_Layout.gif"></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.2
A fuller example</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Let's
now build a more complex view constructor that does some relatively interesting
tricks. It shows off a few other View subsystem capabilities too. You can find
the full code in fw\samples\Samples.NET\ViewSample. Let's start with a look at
what it produces:</p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1030" type="#_x0000_t75" style='width:300.75pt;
 height:225pt'>
 <v:imagedata src="Views_User_Guide_C_Sharp_files/image001.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=401 height=300
src="Views_User_Guide_C_Sharp_files/image002.jpg" v:shapes="_x0000_i1030"><![endif]></p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Figure
3. The ViewSample display</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>You
can see that we are demonstrating colors, font sizes and styles, and alignment
of data in columns as well as interlinear text. What may be less obvious is
that the example also demonstrates a simple use of style sheets.</p>

<h3 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.2.1
Setting up data</h3>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Let's
think first about the underlying data. Our schema is pretty simple: a book
object which consists of a sequence of section objects each consisting of a
sequence of paragraphs. A book has a name. A section has a title and an
indication of the scripture references it contains. A paragraph can have
multiple versions in different languages, typically two: a source language and
a destination language.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>All
of this data is loaded from an XML file. It looks like this:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:blue'>&lt;?</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;color:maroon'>xml</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:fuchsia'> </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:red'>version</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;color:blue'>=&quot;1.0&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:fuchsia'> </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:red'>encoding</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue'>=&quot;utf-8&quot;</span><span style='font-size:10.0pt;font-family:
"Courier New";mso-fareast-font-family:SimSun;color:fuchsia'> </span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue'>?&gt;</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'> <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:blue'>&lt;</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;color:maroon'>book</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:fuchsia'> </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:red'>name</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;color:blue'>=&quot;Mark&quot;&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>section</span><span
style='color:fuchsia'> </span><span style='color:red'>refs</span><span
style='color:blue'>=&quot;1:1-8&quot;</span><span style='color:fuchsia'> </span><span
style='color:red'>title</span><span style='color:blue'>=&quot;John the Baptist
Prepares the Way&quot;&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;2&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>&quot;The beginning of the gospel
about Jesus Christ, the Son of God.<span style='color:blue'>&lt;/</span><span
style='color:maroon'>s</span><span style='color:blue'>&gt;&lt;/</span><span
style='color:maroon'>para</span><span style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>It is written in Isaiah the
prophet:<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>&quot;I will send my messenger
ahead of you<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>who will prepare your way<span
style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;3&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>&quot;a voice of one calling in
the desert,<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>'Prepare the way for the Lord,
make straight paths for him'&quot;<span style='color:blue'>&lt;/</span><span
style='color:maroon'>s</span><span style='color:blue'>&gt;&lt;/</span><span
style='color:maroon'>para</span><span style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;4&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>And so John came, baptizing in the
desert region and preaching a baptism of repentence for the forgiveness of
sins.<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;5&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>The whole Judean countryside and
all the people of </span><st1:City><st1:place><span style='font-size:10.0pt;
  font-family:"Courier New";mso-fareast-font-family:SimSun'>Jerusalem</span></st1:place></st1:City><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'>
went out to him.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>Confessing
their sins, the were baptized by him in the </span><st1:place><span
 style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
 SimSun'>Jordan River</span></st1:place><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-font-family:SimSun'>...<span
style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='color:blue'>&lt;/</span><span style='color:maroon'>section</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>section</span><span
style='color:fuchsia'> </span><span style='color:red'>refs</span><span
style='color:fuchsia'> </span><span style='color:blue'>=</span><span
style='color:fuchsia'> </span><span style='color:blue'>&quot;1:8-13&quot;</span><span
style='color:fuchsia'> </span><span style='color:red'>title</span><span
style='color:blue'>=&quot;The Baptism and Temptation of Jesus&quot;&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;9&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>At that time Jesus came from </span><st1:City><st1:place><span
  style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
  SimSun'>Nazareth</span></st1:place></st1:City><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-font-family:SimSun'> in </span><st1:place><span
 style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
 SimSun'>Galilee</span></st1:place><span style='font-size:10.0pt;font-family:
"Courier New";mso-fareast-font-family:SimSun'> and was baptized by John in the
Jordan.<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;10&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>As Jesus was coming up out of the
water, he saw heaven being torn open and the Spirit descending on him like a
dove...<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>&lt;</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;&lt;</span><span style='color:maroon'>v</span><span
style='color:fuchsia'> </span><span style='color:red'>n</span><span
style='color:blue'>=&quot;12&quot;/&gt;&lt;</span><span style='color:maroon'>s</span><span
style='color:fuchsia'> </span><span style='color:red'>ws</span><span
style='color:blue'>=&quot;en&quot;&gt;</span>At once the Spirit sent him out
into the desert...<span style='color:blue'>&lt;/</span><span style='color:maroon'>s</span><span
style='color:blue'>&gt;&lt;/</span><span style='color:maroon'>para</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='color:blue'>&lt;/</span><span style='color:maroon'>section</span><span
style='color:blue'>&gt;<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:blue'>&lt;/</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;color:maroon'>book</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue'>&gt;<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Let’s
look first at the code which loads this data into the data cache (LoadData
method)</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                      </span>ITsStrFactory
tsf = (ITsStrFactory)<span style='color:blue'>new</span>
FwKernelLib.TsStrFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>IVwCacheDa
cda = (IVwCacheDa) m_sda;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>XmlDocument
xmlDoc = <span style='color:blue'>new</span> XmlDocument();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>xmlDoc.Load(filename);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>XmlNode
book = xmlDoc.SelectSingleNode(&quot;book&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>int</span> wsAnalysis =
m_wsf.get_Engine(&quot;en&quot;).get_WritingSystem(); <span style='color:green'>//
In real life try to get a meaningful one.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>int</span> wsVern =
m_wsf.get_Engine(&quot;de&quot;).get_WritingSystem(); <span style='color:green'>//
Vernacular ws.<o:p></o:p></span></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>This
creates some objects and constants we’ll need. The string factory is one means
of creating simple ITsString objects; the IVwCacheDa interface is how we get
data loaded into the data access objects. The document is our source (filename
is an argument to the method), and the ‘book’ node is the root of the document
and our starting point. We need a couple of writing systems to work with…in
real life these would probably be attributes of the book, but I got lazy.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Here’s
a little server method:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>public</span> <span style='color:blue'>void</span>
MakeStringProp(<span style='color:blue'>int</span> hvo, XmlNode node, <span
style='color:blue'>string</span> attrName, <span style='color:blue'>int</span>
tag, <span style='color:blue'>int</span> ws, ITsStrFactory tsf,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>IVwCacheDa
cda)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>string</span> val = GetAttrVal(node, attrName);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>if</span> (val == <span style='color:blue'>null</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:1'>        </span><span
style='mso-tab-count:3'>                       </span><span style='color:blue'>return</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>cda.CacheStringProp(hvo,
tag, tsf.MakeString(val, ws));<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>It
converts an expected attribute of the XML node (element) into a string property
stored in the cache. For example, the following call</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>MakeStringProp(khvoBook,
book, &quot;name&quot;, ViewSampleVc.ktagBookName, wsAnalysis, tsf, cda);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>extracts
the ‘name’ attribute of the ‘book’ element, makes a TsString with that contents
and the analysis writing system, and stores it as the ktagBookName property of
the root object, identified as khvoBook.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
next code fragment creates an ITsTextProps representing the properties of text
that is in the analysis writing system and has the ‘verseNumber’ style. We will
use this inside the following loops.</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ITsPropsBldr
tpb = (ITsPropsBldr) <span style='color:blue'>new</span> FwKernelLib.TsPropsBldrClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>tpb.SetIntPropValues((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptWs,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvDefault,
wsAnalysis);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>tpb.SetStrPropValue((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptNamedStyle,
&quot;verseNumber&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>ITsTextProps
ttpVStyle = tpb.GetTextProps();<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-spacerun:yes'> </span>Now we loop over the child nodes of the book,
which should be sections:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>int</span> [] sectionIds = <span style='color:blue'>new</span>
<span style='color:blue'>int</span>[book.ChildNodes.Count];<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>int</span> isection = 0;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>foreach</span> (XmlNode section <span style='color:blue'>in</span>
book.ChildNodes)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>int</span> sectionId = m_hvoNextSection++;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>sectionIds[isection]
= sectionId;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>isection++;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>MakeStringProp(sectionId,
section, &quot;refs&quot;, ViewSampleVc.ktagSectionRefs, wsAnalysis, tsf, cda);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>MakeStringProp(sectionId,
section, &quot;title&quot;, ViewSampleVc.ktagSectionTitle, wsAnalysis, tsf,
cda);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>…<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>cda.CacheVecProp(khvoBook,
ViewSampleVc.ktagBookSections, sectionIds, sectionIds.Length);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>We
assign a unique ID to each section, and accumulate a list, which at the end of
the loop we store as a vector property of the book. We also save the references
and title attributes as string properties.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
similar loop (omitted here) over the child nodes of each section initializes
the <span style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
SimSun'>ktagSectionParas</span><span style='mso-fareast-font-family:SimSun'>
property of each section with newly allocated IDs of paragraph objects.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>The loop which processes each paragraph
element is more interesting:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>ITsStrBldr
tsb = (ITsStrBldr) <span style='color:blue'>new</span>
FwKernelLib.TsStrBldrClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span><span
style='color:blue'>foreach</span>(XmlNode item <span style='color:blue'>in</span>
para.ChildNodes)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span><span
style='color:blue'>int</span> ichLim = tsb.get_Length();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span><span
style='color:blue'>if</span> (item.Name == &quot;v&quot;)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='mso-tab-count:4'>                               </span><span
style='color:blue'>string</span> num = GetAttrVal(item, &quot;n&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:7'>                                                     </span>tsb.Replace(ichLim,
ichLim, num, ttpVStyle);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span><span
style='color:blue'>else</span> <span style='color:blue'>if</span> (item.Name ==
&quot;s&quot;)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:7'>                                                     </span><span
style='color:blue'>string</span> wsName = GetAttrVal(item, &quot;ws&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:7'>                                                     </span><span
style='color:blue'>int</span> ws = wsName == <span style='color:blue'>null</span>
? wsAnalysis : <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:7'>                                                     </span><span
style='mso-tab-count:1'>        </span>m_wsf.get_Engine(wsName).get_WritingSystem();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:7'>                                                     </span>tsb.ReplaceTsString(ichLim,
ichLim, tsf.MakeString(item.InnerText, ws)); <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:6'>                                              </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>cda.CacheStringAlt(paraId,
ViewSampleVc.ktagParaContents, wsAnalysis, tsb.GetString());<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>For
constructing a more complex string we use a string builder (ITsStrBldr). (Note
that we can’t just make a TsString and keep adding things to it…TsStrings are
immutable, and can’t be modified at all once created.) The string builder
allows a complex string to be created piecemeal, and then finally retrieved
complete.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Each
child of a &lt;para&gt; element is either an &lt;s&gt; (simple string) element
or a &lt;v&gt; (verse number) element. We are effectively appending each bit of
text to the builder, but using the ‘Replace’ method since string builder
doesn’t have an Append. Verses are assumed to be in the analysis language (we
use our verseNumber style/analysis writing system TsTextProps object to tell
the string builder this). For the string fragments, we allow each fragment to
specify its writing system. At the end, we retrieve the TsString from the
builder, and cache it as the analysis writing system ‘alternative’ of the
paragraph contents.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>(Note
that our data model allows some string properties to be ‘multilingual’.
Actually, there are two ways they can be multilingual: along the length of the
string, a single TsString can be in multiple writing systems, and hence
languages. In addition, we can represent parallel versions of the whole string
in different writing systems…these are called alternatives, and accessed using
methods like CacheStringAlt which take a writing system argument as well as a
property argument.)</p>

<p><span style='mso-fareast-font-family:SimSun'>The verse numbers are made red
by creating them with the ‘verseNumber’ style (a string-valued property,
kttpNamedStyle), and then creating a very minimal implementation of
IVwStyleSheet (SimpleStyleSheet) which defines that style to mean a red
superscript. This is a useful technique because a different style sheet could
produce a quite different appearance. This style sheet is passed to the
SetRootObject method (see below).<o:p></o:p></span></p>

<h3 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.2.2
MakeRoot</h3>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Our
MakeRoot method is about as simple as it can be, since the data loading is all
taken care of by the LoadData call.</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>public</span> <span style='color:blue'>override</span> <span
style='color:blue'>void</span> MakeRoot()<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb
= (IVwRootBox)<span style='color:blue'>new</span> FwViews.VwRootBoxClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.SetSite(<span
style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda
= (ISilDataAccess) <span style='color:blue'>new</span>
FwViews.VwCacheDaClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// Usually not here, but in some application global passed
to each view.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_wsf
= (ILgWritingSystemFactory) <span style='color:blue'>new</span>
FwLanguage.LgWritingSystemFactoryClass();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_sda.set_WritingSystemFactory(m_wsf);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.set_DataAccess(m_sda);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_vc
= <span style='color:blue'>new</span> ViewSampleVc(); <span style='color:green'>//
Before LoadData, which sets some of its properties.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:green'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>LoadData(&quot;data.xml&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_rootb.SetRootObject(khvoBook,
m_vc, ViewSampleVc.kfrBook, <span style='color:blue'>new</span>
SimpleStyleSheet());<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_fRootboxMade
= <span style='color:blue'>true</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>m_dxdLayoutWidth
= -50000; <span style='color:green'>// Don't try to draw until we get OnSize
and do layout.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<h3 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.2.3
The view constructor</h3>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Most
of the interest is in the view constructor, ViewSampleVc. It starts like this,
with the code that describes how to display a book:</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>public</span> <span style='color:blue'>override</span> <span
style='color:blue'>void</span> Display(IVwEnv vwenv, <span style='color:blue'>int</span>
hvo, <span style='color:blue'>int</span> frag)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>switch</span> (frag)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>default</span>:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>case</span> kfrBook:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='mso-tab-count:1'>        </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptFontSize,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvMilliPoint, 24000);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptBold, (<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvEnum,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextToggleVal.kttvOn);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                              </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptAlign, (<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvEnum,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextAlign.ktalCenter);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddStringProp(ktagBookName,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddLazyVecItems(ktagBookSections,
<span style='color:blue'>this</span>, kfrSection);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Note
that the root hvo, khvoBook, was passed as the first argument to SetRootObject
(in MakeRoot) and so becomes the first hvo passed to Display. The fragment, <span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'>kfrBook,
</span><span style='mso-fareast-font-family:SimSun'>was passed as the third argument
of SetRootObject, and identifies the appropriate case to use in displaying a
book.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>The display of a book basically has two
parts, the last two lines of this case. The AddStringProp call tells the vwenv
to display the string property identified by ktagBookName. Recall that our data
loader stored the book name from the data file in the cache using this hvo and
tag. The last line tells the vwenv to display the sections (the list of ids
that we cached as ktagBookSections) using the kfrSection fragment.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Before we go on to review how sections
are displayed, look at the lines preceding the AddStringProp. These lines set
properties for the next thing…in this case, the paragraph that gets created for
the string…that we put in the display. Specifically, they make it 24 point
text, bold, and centerted.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Display properties are mostly set using
this set_IntProperty method. The first argument is always a member of the
FwTextPropType enumeration (documented in fw\kernel\TextServe.idh), and the
second always a member of FwTextPropVar. Here ‘var’ is short for ‘variation’,
that is, one of several variations on how to set the particular property. It’s
a bit like a unit of measurement, but more general. The most common ones are
the two used here: ktpvMillPoint (an absolute size, in 1000ths of a point, that
is 1/72000 of an inch), and ktpvEnum (a member of an enumeration; see the
documentation of the particular property to find out which enumeration to use).<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Note that the sections are displayed in
a manner described as ‘lazy’. This means that the view tries not to do all the
work associated with displaying all the sections…it just does as many sections
as are visible on the screen. When you use this method, you are required to
implement another method that estimates the height of a section:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>public</span> <span style='color:blue'>override</span> <span
style='color:blue'>int</span> EstimateHeight(<span style='color:blue'>int</span>
hvo, <span style='color:blue'>int</span> frag, <span style='color:blue'>int</span>
dxAvailWidth)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>switch</span> (frag)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>default</span>:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>return</span> 1000;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>case</span> kfrBook:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>return</span> 1000;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>case</span> kfrSection:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>return</span> 300;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>}<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>As you can see, it is a very rough
estimate! That’s fine…if it is too large, the worst that happens is that the
scroll range looks a bit too long, and a very small amount of extra work is
done by expanding sections one at a time instead of in a group. It is more
harmful if it is too small, especially if it is less than the height of a
screen: this will cause the program to do quite a lot of extra work, expanding
sections that turn out not to be visible at all.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>When you use AddLazyVecItems to display
the ktagBookSections property, the system uses your estimate to figure how many
sections will fit on the screen. Then, it calls Display again, passing (in
turn) each of the IDs you cached as the value of ktagBookSections, and the frag
you passed to AddLazyVecItems (kfragSection). So the next case in our Display
method deals with displaying a (single) section.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>case</span> kfrSection:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='mso-tab-count:1'>        </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptItalic, (<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvEnum,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:5'>                                      </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextToggleVal.kttvOn);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.OpenParagraph();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddStringProp(ktagSectionTitle,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddString(m_tssLeftParen);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddStringProp(ktagSectionRefs,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddString(m_tssRightParen);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.CloseParagraph();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>vwenv.AddLazyVecItems(ktagSectionParas,
<span style='color:blue'>this</span>, kfrDoublePara);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:blue'>case</span> kfrDoublePara:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>AddDoublePara(vwenv,
hvo);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='mso-tab-count:
1'>      </span>vwenv.set_IntProperty((<span style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptBackColor,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:6'>                                    </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvDefault,
m_colorEditable);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>vwenv.OpenParagraph();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>vwenv.AddObjVecItems(ktagParaBundles,
<span style='color:blue'>this</span>, kfrBundle);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>vwenv.CloseParagraph();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>break</span>;<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>The display of a section is rather
similar to the one for a book, except that we want to put a total of four
strings in a single paragraph at the start. This requires us to explicitly open
a paragraph and close it again. (By default, each AddStringProp/AddString
creates a distinct paragraph). The end of the paragraph is marked by
CloseParagraph. As well as displaying the title and section references, we
display a couple of literal strings (you can see how they are made in the
setter for SourceWs) to punctuate things.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Once again, the bulk of the section is
the (lazy) display of its paragraphs, which results in further recursive calls
to Display, with the paragraph ids and fragment. The implementation of the side-by-side
display of the source and destination text has been broken out into a separate
method (in this case, just to keep the Display method from getting too long,
though it’s also a useful technique when you want to re-use a part of a display).
After that, we create the interlinear display of the paragraph bundles by
opening a paragraph and inserting the object vector property. This whole
paragraph is given a background color that indicates it is editable. (m_colorEditable
is initialized to </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'>(<span style='color:blue'>int</span>)RGB(Color.FromKnownColor(KnownColor.Window))</span><span
style='mso-fareast-font-family:SimSun'>…this unobvious modification is needed
because C# has a different model of colors from the original Windows API that
the View code uses.)<o:p></o:p></span></p>

<h3 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>5.2.3 Tables<o:p></o:p></span></h3>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>The display of a ‘paragraph’ object is,
in this case, a table containing two cells, one with the source alternative,
and one with the vernacular (translated) alternative. Making a table is a bit
complicated, because there are lots of options. This fairly simple case works
like this:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span><span
style='color:blue'>internal</span> <span style='color:blue'>void</span>
AddDoublePara(IVwEnv vwenv, <span style='color:blue'>int</span> hvo)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:2'>               </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// We use a table to display the source WS in column 1, and
the dest ws in column 2.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>FwViews.VwLength
vlTable; <span style='color:green'>// we use this to specify that the table
takes 100% of the width.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vlTable.nVal
= 10000;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vlTable.unit
= FwViews.VwUnit.kunPercent100;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>FwViews.VwLength
vlColumn; <span style='color:green'>// and this one to specify half the width
for each column<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vlColumn.nVal
= 5000;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vlColumn.unit
= FwViews.VwUnit.kunPercent100;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// Enhance JohnT: possibly allow for right-to-left UI by
reversing columns?<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:green'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.OpenTable(2,
<span style='color:green'>// Two columns.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span><span
style='color:blue'>ref</span> vlTable, <span style='color:green'>// Table uses
100% of available width.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>0,
<span style='color:green'>// Border thickness.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>FwViews.VwAlignment.kvaLeft,
<span style='color:green'>// Default alignment.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>FwViews.VwFramePosition.kvfpVoid,
<span style='color:green'>// No border.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>FwViews.VwRule.kvrlNone,
<span style='color:green'>// No rules between cells.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>3000,
<span style='color:green'>// Three points of space between cells.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>3000);
<span style='color:green'>// Three points padding inside cells.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// Specify column widths. The first argument is the number
of columns,<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// not a column index. <o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.MakeColumns(2,
vlColumn);<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Tables make use in several places of a
VwLength object, which combines an actual measurement with an enumeration that
gives a unit. The most commonly used unit is kunPercent100, meaning 100<sup>th</sup>
of a percent, so that 10000 is 100%. By passing 100% as the first argument to
OpenTable, we make the table occupy the full available width. By making each
column 50%, (the second VwLength), we will divide the window in half. The
OpenTable call has many arguments; you can see the meaning from the comments,
or the documentation in Views.idh. You should indicate the width of each column
by making calls to MakeColumns; as shown here, if two columns have the same
width, you can indicate this using the first argument.<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>The balance of the method makes a single
row and two cells:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.OpenTableBody();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.OpenTableRow();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// Source cell, not editable<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.OpenTableCell(1,1);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptEditable, (<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvEnum,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>(<span
style='color:blue'>int</span>)FwKernelLib.TptEditable.ktptNotEditable);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.AddStringAltMember(ktagParaContents,
m_wsSrc, <span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.CloseTableCell();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span><span
style='color:green'>// Dest cell, editable, therefore with white background.<o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptBackColor, (<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvDefault,<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:4'>                               </span>m_colorEditable);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.OpenTableCell(1,1);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.AddStringAltMember(ktagParaContents,
m_wsDst, <span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.CloseTableCell();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.CloseTableRow();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.CloseTableBody();<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
mso-layout-grid-align:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span style='mso-tab-count:3'>                       </span>vwenv.CloseTable();<o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>Note that we set a property to make sure
that the user cannot edit the source text, and another to make the background
color of the destination something that indicates it is editable. <o:p></o:p></span></p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='mso-fareast-font-family:SimSun'>(Where you don’t set an explicit
background color for something, the background color of the container shows
through. In this case it is the light gray color set in the process of
constructing the view: </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun;color:blue'>this</span><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'>.m_myView.BackColor
= System.Drawing.SystemColors.ControlLight;</span><span style='mso-fareast-font-family:
SimSun'>).<o:p></o:p></span></p>

<h3><span style='mso-fareast-font-family:SimSun'>5.2.4 Interlinear text<o:p></o:p></span></h3>

<p><span style='mso-fareast-font-family:SimSun'>As noted above, we insert the
interlinear text by making a paragraph and inserting the bundle objects. (If
you run the program and want to see this…type some text into one of the
right-hand panes, then right-click on that paragraph.) A bundle is displayed
like this:<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>case</span>
kfrBundle:<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:green'>//
Put a little space after each bundle to separate them.<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='mso-tab-count:
1'>      </span>vwenv.set_IntProperty((<span style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptMarginTrailing,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvMilliPoint, 5000);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.OpenInnerPile();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.AddStringProp(ktagBundleBase,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptBold,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvEnum,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextToggleVal.kttvOn);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptFontSize,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvMilliPoint, 13000);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.AddStringProp(ktagBundleIdiom,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.set_IntProperty((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptFontSize,<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>(<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropVar.ktpvMilliPoint, 8000);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.AddStringProp(ktagBundleLing,
<span style='color:blue'>this</span>);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>vwenv.CloseInnerPile();<o:p></o:p></span></p>

<p><span style='mso-fareast-font-family:SimSun'>Note first that a ‘bundle’ is
an ‘InnerPile’…a vertical grouping of lines within a paragraph. The inner pile
is given five points of trailing margin to separate it from the next. The pile
simply shows three text properties, in varying styles and point sizes.<o:p></o:p></span></p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>5.4
What else is there?</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>We've
covered the most commonly used features of the IVwEnv interface that you need
to know for creating view constructors, and several of the less commonly used
ones. Here is a brief summary of some others you might use.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>AddObjVec.
Rather like AddObjVecItems, but instead of calling your Display method once for
each item, the system calls DisplayVec just once. This provides additional
flexibility (you can reorder or filter the list, or insert separators or
numbers), but you have to do more work, and the system has to redisplay the
whole sequence if any item changes).</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>NoteDependency.
Use this method to tell the View that part of your display depends on the value
of a property that the view code would not otherwise know about. For example,
if you tell the view code to AddObjVec and pass arguments indicating a
particular property of a particular object is to be displayed, then the view
code automatically knows that if that property changes, the display needs to
change. But, suppose you are displaying only those lex entries in the sequence
that have more than one sense. If the senses property of any of the entries
changes, your display needs to update! But the view code does not know this.
Using this mechanism, you can tell the Views code to recompute the display of
this property if any of the senses properties changes.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>AddWindow.
This is intended to allow you to embed an arbitrary window (with contents and
behavior under your control) in the middle of a view. It is not yet
implemented.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>AddSeparatorBar.
This inserts the standard &quot;separator bar&quot; used in FieldWorks data
entry views to separate items in a list of references.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>AddSimpleRect.
This just inserts a colored rectangle. It is currently used to help create
previews, where the rectangles stand for arbitrary text.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Open/CloseDiv
and Open/CloseSpan. A Division is a group of paragraphs, while a span is a
group of strings within a paragraph. Grouping them in divisions and spans makes
it easier to specify common properties. (The flow object names are taken from
HTML.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>OpenTaggedPara.
This creates a paragraph which supports the kind of overlay tagging used in the
Data Notebook. This probably deserves a whole section of this document to
itself, but I'm not going to write it until someone else wants to use it.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>OpenMappedPara.
This is used for an even smarter kind of paragraph that can replace an object
character with information computed from a reference attached to it. We use it
for hot links and in displaying object references within a filter.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>OpenConcPara.
This is used to make concordance lines: paragraphs that always occupy a single
line, and align a keyword at a particular position, and can bold the keyword.
They should normally be used inside table cells, which clip their contents,
since there is no guarantee that a concordance paragraph will draw only within
the space allocated to it. We may well add more options to this feature.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>StringWidth.
(Actually get_StringWidth.) This allows you to measure the space that a
particular string will take up in the display. A typical use is to adjust table
column widths.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>AddPicture.
This embeds a picture into the display. See fw\src\IText\Sandbox.cs for an
example of using this to embed a pull-down icon and associate a pull-down menu
with it.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Tables
have many more options. See the C++ Views User Guide for a much more extensive
example.</p>

<h1 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>6
IVwSelection</h1>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Selections
in the Views code can happen in one of two ways. The most usual is that some
user action is interpreted by the views code as creating a selection. Clicks,
shift-clicks, double-clicks, and drags have their usual effects. Text editing
moves the selection around in the expected ways. It is also possible for a
selection to be created under the control of the client program. For example,
you may wish to select at the start of a particular record, or to select the
text of a word that has been &quot;found&quot;.</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>6.1
The information in a selection</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Conceptually,
a selection is represented as two positions in the text displayed in a window.
One of these is considered to be the &quot;anchor&quot; (the place the user
clicked) and the other the &quot;end-point&quot; (where he dragged to).
Sometimes the two positions are the same (this is called an insertion point).
We can represent this information as character offsets into paragraphs, but
that is often not very useful.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Consider
this diagram, which represents some quite complex information represented as a
paragraph:</p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><img
border=0 width=701 height=334 id="_x0000_i1029"
src="Views_User_Guide_C_Sharp_files/Views_Notifier_Hierarchy.gif"></p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Figure
4: A paragraph with an indication of how it breaks down into objects and
properties.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Suppose
we have selected the &quot;is&quot; in &quot;that is correct.&quot; That is,
characters 40 and 41 in the overall paragraph. That doesn't tell you much.
However, knowing that it is characters 5 and 6 of the translation of example
1.1 is likely to be more useful. To that we can add the information that
example 1.1 is item 0 in the examples of sense 1, which is sense 0 in the
senses of the top level entry.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>We
can also reverse this process: ask the system to create a selection that is
characters 5 and 6 of the translation of sentence 0 in the examples of sense 0
of the root entry.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>In
general, then, the information we use to describe a selection consists of a
path from the root object down to a particular string property of a particular
object. Each step in the path involves a tag which identifies the property, and
if it is a sequence property, the position in the sequence.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>(Note:
there are also picture selections. These have some of the same behaviors.)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>In
this simple example, it would actually be enough to just say that we have
selected characters 5-6 of the translation of example 1.1. However, in general,
a display could contain the same property of the same object in more than one
place. So an unambiguous specification of the selection needs to include the
full path. Also, in a large display, searching the whole thing for the display
of example 1.1 could be expensive, particularly if example 1.1 happens to be
data that we have not yet loaded. (It's even worse if we want something in
example 1.2, but have to load example 1.1 in order to search through it.) For
all these reasons, when specifying a selection, it is necessary to give a full
path.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>There
are three complications to the process of specifying the path to a selection
that we have not yet considered.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>First,
it is possible for a view to have more than one top-level, or root, object.
Thus, in general, the path to a selection includes an index into the list of
root objects.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Next,
the terminal property, containing the actual characters selected, might be a
multlingual one. In that case, it is important to know which alternative the
selection is part of (especially if more than one is visible).</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Finally,
it is possible that a property is displayed more than once. Consider a display
of a document which first displays its sections using a fragment identifier
that produces just the title of a section (thus producing a table of contents),
and then displays the sections again using a different fragment identifier to
produce the actual content. Now it is not enough just to know that the
selection is in the title of section 4 of the document; we have to know whether
it is in the first or second occurrence of the sections property in the display
of the document.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Thus,
in general, one step in the path from the root down to the actual selection consists
of a property tag, a count indicating how many previous occurrences of that
property there have been in the display of the parent object (usually 0), and
an index into the property (in case it is a sequence one). Thus, the complete
specification of the 'Which' above looks like this:</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>0
(indicates the first and only root object Entry)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>kflidLexEntry_Senses,
0 (the first occurrence of senses in the entry), 0 (first sense in the
property)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>kflidLexSense_Examples,
0 (first occurrence of examples property), 1 (second example)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>kflidLexExampleSentence_Translation,
0 (first occurrence of property), 0 (a dummy, basic properties can't be
sequence)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>740664001
(indicates the English alternative of the translation)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>0,
5 (indicates the range of characters within the property)</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>If
this seems clumsy, you might consider that it will continue to work even if one
or more of the preceding strings in the paragraph is edited.</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>6.2
Setting a selection programmatically</h2>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Often,
you don't have to give the complete path. For example, if the user has
performed an action that should result in placing the insertion point at the
start of the second example of the first sense, only the first two steps in the
above path are needed.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>For
example, the following code selects at the start of a particular item at
position (ihvoCurr) from a sequence of records in the research notebook:</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>(Todo:
update this example to C#).</p>

<pre><span style='mso-tab-count:1'>        </span>VwSelLevInfo vsli;</pre><pre><span
style='mso-tab-count:1'>        </span>vsli.tag = kflidRnResearchNotebook_Records;</pre><pre><span
style='mso-tab-count:1'>        </span>vsli.cpropPrevious = 0;</pre><pre><span
style='mso-tab-count:1'>        </span>vsli.ihvo = ihvoCurr;</pre><pre><span
style='mso-tab-count:1'>        </span>// DO NOT CheckHr. This can legitimately fail, e.g., if there are no editable fields.</pre><pre><span
style='mso-tab-count:1'>        </span>prbvw-&gt;m_qrootb-&gt;MakeTextSelInObj(</pre><pre><span
style='mso-tab-count:2'>               </span>0, // index of the one and only root object in this view</pre><pre><span
style='mso-tab-count:2'>               </span>1, // the object we want is one level down</pre><pre><span
style='mso-tab-count:2'>               </span>&amp;vsli, // and here's how to find it there</pre><pre><span
style='mso-tab-count:2'>               </span>true, // select at the start of it</pre><pre><span
style='mso-tab-count:2'>               </span>true, // Find an editable field</pre><pre><span
style='mso-tab-count:2'>               </span>false); // and don't select a range.</pre><pre><span
style='mso-tab-count:1'>        </span>prbvw-&gt;MakeSelectionVisible();</pre>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>You
can think of a VwSelLevelInfo as one triple in the lists above. It indicates a particular
property of the next higher object, a particular occurrence of that property,
and a particular object within it.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>A
considerably more complex example of the sorts of tricks you can do with
selections may be found in the AfDeFeTags class.</p>

<h2 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>6.3
Getting information about a selection</h2>

<p><span style='mso-fareast-font-family:SimSun'>The text with a white
background in our sample program is automatically editable. (Recall that we
went out of our way to make some of the other strings NOT editable, setting
kttpEditable.) The user can click on any of this text and type.<o:p></o:p></span></p>

<p><span style='mso-fareast-font-family:SimSun'>A couple of special behaviors
have been defined in this program, mainly as a way of demonstrating some of the
kinds of things that can be done with selections. For example, any digits typed
in the text are assumed to be verse numbers, and put into the appropriate
style. This happens in the HandleSelectionChange method, which is automatically
called every time the selection is changed.<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>            </span><span style='color:blue'>protected</span>
<span style='color:blue'>override</span> <span style='color:blue'>void</span>
HandleSelectionChange(IVwSelection vwselNew)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:2'>            </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>base</span>.HandleSelectionChange
(vwselNew);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>if</span>
(vwselNew == <span style='color:blue'>null</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:blue'>return</span>;
<span style='color:green'>// Not sure whether this happens, but best to be
sure.<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:green'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span></span><span lang=DE
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue;mso-ansi-language:DE'>int</span><span lang=DE style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-font-family:SimSun;mso-ansi-language:
DE'> ichSel, hvoObj, tag, ws;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
lang=DE style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:
SimSun;mso-ansi-language:DE'><span style='mso-tab-count:3'>                  </span></span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun;
color:blue'>bool</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'> fAssocPrev;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>ITsString tss;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                 </span>vwselNew.TextSelInfo(<span
style='color:blue'>false</span>, <span style='color:blue'>out</span> tss, <span
style='color:blue'>out</span> ichSel, <span style='color:blue'>out</span>
fAssocPrev, <span style='color:blue'>out</span> hvoObj, <span style='color:
blue'>out</span> tag, <span style='color:blue'>out</span> ws);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>string</span>
text = tss.get_Text();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>if</span>
(text == <span style='color:blue'>null</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:blue'>return</span>;
<span style='color:green'>// empty string.<o:p></o:p></span></span></p>

<p><span style='mso-fareast-font-family:SimSun'>After calling the base method,
we retrieve various information from the selection, the most important of which
is the string that the selection is part of.<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>ITsStrBldr tsb = <span
style='color:blue'>null</span>;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>for</span>
(<span style='color:blue'>int</span> ich = 0; ich &lt; text.Length; ++ich)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:blue'>if</span>
(Char.IsDigit(text[ich]))<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>ITsTextProps ttp =
tss.get_PropertiesAt(ich);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span><span
style='color:blue'>string</span> styleName = ttp.GetStrPropValue((<span
style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptNamedStyle);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span><span
style='color:blue'>if</span> (styleName != &quot;verseNumber&quot;)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:6'>                                    </span><span
style='color:green'>// We'll change just this one character. We could make this
more efficient for dealing with<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:6'>                                    </span><span
style='color:green'>// long strings of digits, but it's unlikely we'll ever
have to deal with more than one.<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:6'>                                    </span><span
style='color:blue'>if</span> (tsb == <span style='color:blue'>null</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:7'>                                          </span>tsb =
tss.GetBldr();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:6'>                                    </span>tsb.SetStrPropValue(ich,
ich + 1, (<span style='color:blue'>int</span>)FwKernelLib.FwTextPropType.ktptNamedStyle,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span
style='mso-spacerun:yes'> </span>&quot;verseNumber&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:5'>                              </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>}<o:p></o:p></span></p>

<p><span style='mso-fareast-font-family:SimSun'>Then we just loop over the
string, looking for digits. If we find at least one digit that doesn’t have the
verse number style, we create a string builder out of the original string, and
set the style of that character. (This would be quite inefficient for some
situations, but in this case, it’s unlikely that more than one character has
the wrong style. Of course, it is also overkill…Scripture contains numbers that
are not verse numbers…but this is only meant as an illustrative example.)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span><span style='color:blue'>if</span>
(tsb != <span style='color:blue'>null</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>ISilDataAccess sda =
m_rootb.get_DataAccess();<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:green'>//
In this sample the only string is a multistring. If in doubt, we could test for
ws == 0 to<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span><span style='color:green'>//
see whether it is a simple string.<o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>sda.SetMultiStringAlt(hvoObj,
tag, ws, tsb.GetString());<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:4'>                        </span>sda.PropChanged(<span
style='color:blue'>null</span>, (<span style='color:blue'>int</span>)FwViews.PropChangeType.kpctNotifyAll,
hvoObj, tag, 0, tss.get_Length(),<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:2.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-font-family:SimSun'><span
style='mso-spacerun:yes'> </span>tss.get_Length());<o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:SimSun'><span
style='mso-tab-count:3'>                  </span>}<o:p></o:p></span></p>

<p><span style='mso-fareast-font-family:SimSun'>If we made a string builder, we
must have needed to change something. So we write the new value into the cache.
Also, we call a method to broadcast this change to all views. This causes the
view to immediately redisplay with the corrected verse number. The first two
arguments to this method are almost always as shown here, though it is possible
to pass a root box and tell the system to update all other ones (this is
sometimes used within the Views code, if the current view has already been
updated). Then come the object and property that has changed, and then three
arguments that can be used to inform the system that only some of the property
has changed. (There’s a start index, number inserted, and number deleted.) Here
we’re being lazy…instead of keeping track, we just tell the system that the
whole string changed. It is always safe to do this, though it may harm performance.<o:p></o:p></span></p>

<h1 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>7
Where next?</h1>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>This
concludes the introduction to using views. Where do you go for more
information?</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>There
are many real-life examples of using views in TE, LexEd, IText, and also in the
C++ programs Data Notebook and WorldPad. The Document and Browse views offer
some complex examples of customizable views. The data entry framework (see AfDe
classes in AppCore) uses views extensively. WorldPad offers a real-life example
of using View code without a database connection.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>You
can study the interfaces in Views.idh to get the more formal documentation of what
the various methods do. You will probably also need to study the interfaces in
TextServe.idh (FwKernel) to learn how to use ITsString and ITsTextProps and
related classes.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>The
style dialog used in TE and elsewhere can readily be launched by a menu command
and the results applied to your text. The other data notebook text format
dialogs have not yet been fully wrapped for C# access, but easily could be if
wanted.</p>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>Please
feel free to suggest topics that should be covered in more depth here or
elsewhere.</p>

</div>

</body>

</html>
